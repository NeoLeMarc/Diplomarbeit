input metauml;
beginfig(1);

    % Hauptklasse
    Class.MANVConnector("MANVConnector")
            ("-commandQueue: BlockingQueue<MANVCommand>",
             "-eventQueue: BlockingQueue<MANVEvent>",
             "-resultQueue: BlockingQueue<MANVCommand>",
             "-corbaSender: CorbaSender",
             "-commandsImpl: CommandsImpl")
            ("+main(args: String[]): void");

    % ZigBee Krempel
    Class.iZigBit("iZigBit")
            ()
            ("+getNodeID: int",
             "+getMacID: int",
             "+sendData(data: String): MANVResult",
             "+isendData(data: String)",
             "+toggleAlertStatus: MANVResult",
             "+disableAlert: MANVResult",
             "+enableAlert: MANVResult",
             "+muteAlert: MANVResult",
             "+itoggleAlertStatus: void",
             "+idisableAlert: void",
             "+ienableAlert: void",
             "+imuteAlert: void");
    classStereotypes.iZigBit("<<Interface>>");

    Class.readonlyZigBit("readonlyZigBit")
            ("-id: int")
            ("+readOnlyZigBit(nodeID: int",
            "+getNodeID: int",
            "+getMacID: int",
            "+sendData(data: String): MANVResult",
            "+toggleAlertStatus: void",
            "+enableAlertStatus: void",
            "+disableAlert: void",
            "+muteAlert: void");

    Class.ZigBit("ZigBit")
            ("-zigBitMap: HashMap<Integer, ZigBit>",
             "-macMap: HashMap<Integer, Integer>")
            ("+ZigBit(nodeID : int)",
            "+getNodeID: int",
            "+getMacID: int",
            "+setCommandQueue(commandQueue: BlockingQueue<MANVCommand>)",
            "+get(id: int): iZigBit",
            "+getByMacID(macID: int): iZigBit",
            "+discover: iZigBit",
            "+sendData(data: String): MANVResult",
            "+sendUntilSuccess(data: String): MANVResult",
            "+toggleAlertStatus: MANVResult",
            "+enableAlertStatus: MANVResult",
            "+disableAlert: MANVResult",
            "+mutAlert: MANVResult",
            "-requestMacID: int");


    
    leftToRight.top(100)(iZigBit, MANVConnector);
    topToBottom(45)(iZigBit, readonlyZigBit);
    leftToRight.top(45)(readonlyZigBit, ZigBit);

    drawObjects(MANVConnector, iZigBit, readonlyZigBit, ZigBit);
    link(inheritance)(pathStepY(readonlyZigBit.n, iZigBit.s, 20));
    link(inheritance)(pathStepY(ZigBit.n, iZigBit.s, 20));


    Class.CORBA_Node("CORBA_Node")
            ()
            ();

    Class.CommandsImpl("CommandsImpl")
            ()
            ("+disableAlert(node: CORBA_Node)",
            "+enableAlert(node: CORBA_Node)",
            "+toggleAlert(node: CORBA_Node)",
            "+mute(node: CORBA_Node)");

    leftToRight.top(90)(ZigBit, CORBA_Node);
    topToBottom(45)(CORBA_Node, CommandsImpl);
    drawObjects(CORBA_Node, CommandsImpl);
    link(inheritance)(pathStepY(CommandsImpl.n, CORBA_Node.s, 20));

    Class.BlockingQueueMANVEvent("BlockingQueue<MANVEvent>")
            ()
            ();

    Class.BlockingQueueMANVCommand("BlockingQueue<MANVCommand>")
            ()
            ();

    topToBottom(45)(BlockingQueueMANVEvent, MANVConnector);
    leftToRight.top(45)(BlockingQueueMANVEvent, BlockingQueueMANVCommand);
    drawObjects(BlockingQueueMANVEvent, BlockingQueueMANVCommand);

    % Threads
    Class.Thread("Thread")
            ()
            ("run: void");

%    leftToRight.top(500)(Comparable, Thread);


    Class.SocketReader("SocketReader")
            ("-eventQueue: BlockingQueue<MANVEvent>",
            "-lastResult: MANVResult",
            "-resultSemaphore: Semaphore",
            "-serialIn: BufferReader")
            ("+SocketReader(serialIn: BufferedReader, eventQueue: BlockingQueue<MANVEvent>)",
            "+setLastResult(MANVResult: result)",
            "+getLastResult(MANVResult: result)",
            "run: void");

    Class.SocketWriter("SocketWriter")
            ("-commandQueue: BlockingQueue<MANVCommand>",
            "-resultQueue: BlockingQueue<MANVCommand>",
            "-serialOut: PrintWriter",
            "-reader: SocketReader",
            "-lastResult: MANVResult")
            ("+SocketWriter(serialOut: PrintWriter, commandQueue: <MANVCommand>, reader: SocketReader)",
            "+writeLine(line: String)",
            "+run: void");

    Class.CorbaSender("CorbaSender")
            ("-eventQueue: BlockingQueue<MANVEvent>",
            "-serverIncoming: Incoming")
            ("+CorbaSender(eventQueue: BlockingQueue<MANVEvent>, serverIncoming: Incoming)",
            "+run: void");

    topToBottom(45)(Thread, SocketWriter);
    topToBottom(45)(SocketWriter, BlockingQueueMANVEvent);
    leftToRight.top(45)(SocketReader, SocketWriter, CorbaSender);
    drawObjects(Thread, SocketReader, SocketWriter, CorbaSender);
    link(inheritance)(pathStepY(SocketReader.n, Thread.s, 20));
    link(inheritance)(pathStepY(SocketWriter.n, Thread.s, 20));
    link(inheritance)(pathStepY(CorbaSender.n, Thread.s, 20));

    % Events
    Class.Comparable("Comparable")
            ()
            ("+compareTo(o: object): int");
    classStereotypes.Comparable("<<interface>>");
    leftToRight(45)(Comparable, readonlyZigBit);
    drawObjects(Comparable);


    Class.MANVPrioritized("MANVPrioritized")
            ("#priority: int")
            ("+compareTo(o: MANVPrioritized): int",
            "+compareTo(o: object): int");

    topToBottom(45)(Comparable, MANVPrioritized);
    drawObject(MANVPrioritized);
    link(inheritance)(pathStepY(MANVPrioritized.n, Comparable.s, 20));

    Class.MANVEvent("MANVEvent")
            ("-raw: String")
            ("+MANVEvent(raw: String)",
            "+isResult: boolean",
            "+isImportant: boolean",
            "+fromString(raw: String): MANVEvent",
            "+createCorbaMessages: AbstractList<CorbaMessageContainer>",
            "+toString: String",
            "+getRaw: String");

    topToBottom(45)(MANVPrioritized, MANVEvent);
    drawObject(MANVEvent);
    link(inheritance)(pathStepY(MANVEvent.n, MANVPrioritized.s, 20));

    
    Class.MANVResult("MANVResult")
            ("#status: boolean",
            "#subResult: MANVResult")
            ("+MANVResult(raw: String, subResult: MANVResult)",
            "+getData: String",
            "+isResult: boolean",
            "+isImportant: boolean",
            "+isComposite: boolean",
            "+getChildList(commandQueue: BlockingQueue<MANVCommand>): AbstractList<CorbaMessageContainer>",
            "+getSubResult(result: MANVResult, toString: String): MANVResult");

    Class.MANVCommand("MANVCommand")
            ("#command: String",
            "-result: MANVResult",
            "#id: int",
            "#maxId: static int",
            "-resultLatch: CountDownLatch")
            ("+MANVCommand(command: String, priority: int)",
            "+getCommand: String",
            "-getUniqueId: int",
            "+setResult(result: MANVResult)",
            "+getResult: MANVResult");

    topToBottom(45)(MANVEvent, MANVResult);
    leftToRight.top(45)(MANVCommand, MANVEvent);
    drawObjects(MANVResult, MANVCommand);
    link(inheritance)(pathStepY(MANVResult.n, MANVEvent.s, 20));
    link(inheritance)(pathStepY(MANVCommand.n, MANVPrioritized.s, 20));

    Class.MANVDataReceived("MANVDataReceived")
            ("-source: iZigBit",
            "-data: String")
            ("+MANVDataReceived(raw: String)",
            "+isImportant: boolean",
            "+parseRaw(raw: String)");

    Class.MANVChildLost("MANVChildLost")
            ("#source: iZigBit")
            ("+MANVChildLost(raw: String)",
            "+isImportant: boolean",
            "+createCorbaMessages: AbstractList<CorbaMessageContainer>");

    Class.MANVChildJoined("MANVChildJoined")
            ("#source: iZigBit")
            ("+MANVChildLost(raw: String)",
            "+isImportant: boolean",
            "+createCorbaMessages: AbstractList<CorbaMessageContainer>");

    leftToRight.top(90)(MANVResult, MANVDataReceived);
    leftToRight.top(45)(MANVDataReceived, MANVChildLost, MANVChildJoined);
    drawObjects(MANVDataReceived, MANVChildLost, MANVChildJoined);
    link(inheritance)(pathStepY(MANVDataReceived.n, MANVEvent.s, 20));
    link(inheritance)(pathStepY(MANVChildLost.n, MANVEvent.s, 20));
    link(inheritance)(pathStepY(MANVChildJoined.n, MANVEvent.s, 20));


    Class.MANVStatusMessage("MANVStatusMessage")
            ("#pulse: short",
            "#breathing: short",
            "-alertStatus: HashMap<Integer, Integer>")
            ("+MANVStatusMessage(raw: String)",
            "+parseRaw(raw: String)",
            "+createCorbaMessages: AbstractList<CorbaMessageContainer>",
            "+toString: String");

    topToBottom(110)(MANVDataReceived, MANVStatusMessage);
    drawObject(MANVStatusMessage);
    link(inheritance)(pathStepY(MANVStatusMessage.n, MANVDataReceived.s, 20));

    Class MANVGsn("MANVGsn")
            ("-myRaw: String")
            ("+MANVGsn(raw: String)",
            "+isCcomposite: boolean",
            "+getData: String",
            "+addSubResult(result: MANVResult)");

    Class MANVChildrenList("MANVChildrenList")
            ()
            ("+MANVChildrenList(raw: String)",
            "+isComposite: boolean",
            "+getChildList(commandQueue: BlockingQueue<MANVCommand>",
            "+addSubResult(result: MANVResult)");

    leftToRight.top(45)(MANVChildrenList, MANVGsn, MANVStatusMessage);
    drawObjects(MANVGsn, MANVChildrenList);
    link(inheritance)(pathStepY(MANVGsn.n, MANVResult.s, 20));
    link(inheritance)(pathStepY(MANVChildrenList.n, MANVResult.s, 20));



    % Corba
    Class.CorbaMessageContainer("CorbaMessageContainer")
            ()
            ("+send(serverIncoming: Incoming)");

    Class.CorbaDataMessageContainer("CorbaDataMessageContainer")
            ("-message: CORBA_DataMessage")
            ("+CorbaDataMessageContainer(message: CORBA_DataMessage)",
            "+send(serverIncoming: Incoming)",
            "+toString: String");

    Class.CorbaEventMessageContainer("CorbaEventMessageContainer")
            ("-message: CORBA_EventMessage")
            ("+send(serverIncoming: Incoming)",
            "+toString: String)");

    topToBottom(45)(CorbaMessageContainer, CorbaDataMessageContainer);
    leftToRight.top(45)(MANVStatusMessage, CorbaDataMessageContainer, CorbaEventMessageContainer);
    drawObjects(CorbaMessageContainer, CorbaDataMessageContainer, CorbaEventMessageContainer);
    link(inheritance)(pathStepY(CorbaDataMessageContainer.n, CorbaMessageContainer.s, 20));
    link(inheritance)(pathStepY(CorbaEventMessageContainer.n, CorbaMessageContainer.s, 20));



    % Assoziationen
%    link(composition)(BlockingQueueMANVEvent.s -- MANVConnector.n);
%    link(composition)(BlockingQueueMANVCommand.s -- MANVConnector.e);
    clink(composition)(BlockingQueueMANVEvent, MANVConnector);
    item(iGuard)("eventQueue")(obj.nw = BlockingQueueMANVEvent.s + (0, -12));

    clink(composition)(BlockingQueueMANVCommand, MANVConnector);
    item(iGuard)("commandQueue")(obj.nw = BlockingQueueMANVCommand.sw + (29, -12));

    link(composition)(pathStepY(MANVResult.sw, MANVCommand.s, 20));
    item(iGuard)("result")(obj.e = MANVResult.nw + (-60, -10));

    link(composition)(pathStepY(MANVResult.se, SocketWriter.sw + (20, 0), 20));
    item(iGuard)("result")(obj.n = SocketWriter.sw + (30, -60));

    link(composition)(pathStepY(BlockingQueueMANVCommand.n, SocketWriter.se + (-12, 0), 20));
    item(iGuard)("commandQueue")(obj.n = SocketWriter.se + (15, -30));

    clink(composition)(CommandsImpl, MANVConnector);
    item(iGuard)("commandsImpl")(obj.n = MANVConnector.e + (10, -140));

    % TBD
    clink(composition)(MANVResult, SocketReader);
    clink(composition)(MANVDataReceived, iZigBit);
    clink(composition)(MANVChildLost, iZigBit);
            
endfig;
end




















